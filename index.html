<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏û‡∏•‡∏±‡∏™ - ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body { margin: 0; font-family: sans-serif; }
    #map { height: 65vh; }
    .form-container {
      padding: 10px;
      background: #f2f2f2;
      border-top: 1px solid #ddd;
    }
    input, select, textarea, button {
      width: 100%; margin: 6px 0; padding: 10px; font-size: 16px;
    }
    button { cursor: pointer; background: #0078ff; color: white; border: none; }
  </style>
</head>
<body>

<h3 style="text-align:center;">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏û‡∏•‡∏±‡∏™ (‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô)</h3>

<div id="map"></div>

<div class="form-container">
  <h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h4>

  <input id="shopName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô">

  <select id="shopType">
    <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ / ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
    <option value="‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å</option>
    <option value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£">‡∏£‡πâ‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option>
  </select>

  <textarea id="shopDesc" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤"></textarea>

  <button id="btnLocate">üìç ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>

  <p>‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</p>

  <button id="btnSave">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô</button>
</div>


<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDGYuI3yxJbUTc6T_0pm6WiEKZul11tXS0",
    authDomain: "suchartwork-1487382986748.firebaseapp.com",
    databaseURL: "https://suchartwork-1487382986748.firebaseio.com",
    projectId: "suchartwork-1487382986748",
    storageBucket: "suchartwork-1487382986748.firebasestorage.app",
    messagingSenderId: "353884592527",
    appId: "1:353884592527:web:4233ac2ae7eef075eb13fa"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --- MAP ---
  const map = L.map('map').setView([16.4322, 102.8236], 12); // ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  // ‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ
  let marker = L.marker([16.4322, 102.8236], { draggable: true }).addTo(map);

  // ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  document.getElementById("btnLocate").onclick = () => {
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      marker.setLatLng([lat, lng]);
      map.setView([lat, lng], 16);
    });
  };

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô
  document.getElementById("btnSave").onclick = () => {
    const name = document.getElementById("shopName").value.trim();
    const type = document.getElementById("shopType").value;
    const desc = document.getElementById("shopDesc").value.trim();
    const { lat, lng } = marker.getLatLng();

    if (!name) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô");
      return;
    }

    push(ref(db, "shops"), {
      name, type, desc, lat, lng, time: Date.now()
    });

    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
  };

  // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏∏‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö Real-time
  const colors = {
    "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°": "red",
    "‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å": "blue",
    "‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£": "green"
  };

  onValue(ref(db, "shops"), snapshot => {
    map.eachLayer(layer => {
      if (layer instanceof L.Marker && layer !== marker) map.removeLayer(layer);
    });

    snapshot.forEach(s => {
      const d = s.val();
      L.marker([d.lat, d.lng], { icon: L.icon({
        iconUrl: `https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=store|${colors[d.type]}`,
        iconSize: [30, 50]
      })})
      .addTo(map)
      .bindPopup(`<b>${d.name}</b><br>${d.type}<br>${d.desc}`);
    });
  });

</script>
</body>
</html>
